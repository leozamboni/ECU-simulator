<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;400;500;700;900&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
    }

    body {
      overflow: hidden
    }

    #ft {
      width: 600px;
      height: 300px;
      color: white;
      background-color: black;
    }

    #ft .row {
      width: 100;
      height: 35%;
    }

    #ft .row .col {
      width: 33.33%;
      height: 100%;
      float: left;
    }

    #ft :first-child {
      height: 20%;
    }

    #ft .row .col.rpm {
      width: 30%;
      text-align: right;
    }

    #ft .row .col.rpm #rpm {
      font-size: 3em;
      font-weight: bold;
    }

    #ft .row .col.max-rpm {
      width: 20%;
    }

    #ft .row .col.max-rpm #max-rpm {
      font-size: 2em;
    }

    #ft .row.bar {
      display: inline-block;
      margin-top: -80px;
      height: 7%;
    }

    #ft .row.bar #rpm-bar li {
      display: inline-block;
      width: 3px;
      height: 25px;
    }

    #ft .row .col.gear {
      text-align: center;
    }

    #ft .row .col.gear :first-child {
      color: orange;
    }

    #ft .row .col.gear #gear {
      font-size: 7em;
      font-weight: bold;
    }

    #ft .row .col.kmh {
      text-align: right;
    }

    #ft .row .col.kmh :first-child {
      color: orange;
    }

    #ft .row .col.kmh #kmh {
      font-size: 4em;
      font-weight: bold;
    }

    #ft .row .col.tps {
      margin-top: 8%;
      text-align: center;
    }

    #ft .row .col.tps :first-child {
      color: orange;
    }

    #ft .row .col.tps #tps {
      background-color: #242424;
      width: 100%;
      height: 15px;
      text-align-last: justify;
    }

    #ft .row .col.tps #tps span {
      background-color: black;
      display: inline-block;
      width: 1.5px;
      height: 70%;
      transform: translateY(-20%);
    }

    #ft .row .col.tps #tps span p {
      margin-top: 10px;
      color: white;
      position: absolute;
      margin-left: -10px;
    }


    #ft .row .col.tps #tps #tps-bar {
      height: 100%;
      background-color: green;
      margin-top: -20px;
    }

    #ft .row .col.info {
      margin-top: 8%;
      text-align: center;
      display: inline-block;
    }

    #ft .row .col.info .map {
      width: 40%;
      height: 100%;
      float: left;
      margin-left: 10px;
    }

    #ft .row .col.info .map :first-child {
      color: orange;
    }

    #ft .row .col.info .map :last-child {
      font-weight: bold;
    }

    #ft .row .col.info .bat {
      width: 40%;
      height: 100%;
      float: left;
      margin-left: 10px;
    }

    #ft .row .col.info .bat :first-child {
      color: orange;
    }

    #ft .row .col.info .bat :last-child {
      font-weight: bold;
    }

    #ft .row .col.pressure {
      text-align: center;
      display: inline-block;
    }

    #ft .row .col.pressure .oil {
      width: 40%;
      height: 100%;
      float: left;
      margin-left: 10px;
    }

    #ft .row .col.pressure .oil #oilp {
      height: 70%;
      background-color: green;
    }

    #ft .row .col.pressure .fuel {
      width: 40%;
      height: 100%;
      float: left;
      margin-left: 10px;
    }

    #ft .row .col.pressure .fuel .fuelp {
      background-color: #242424;
      overflow-y: hidden;
      height: 70%;
      width: 100%;
      position: relative;
    }

    ::-webkit-scrollbar {
      width: 2px;
    }

    ::-webkit-scrollbar-thumb {
      width: 2px;
      background-color: red;
    }

    #ft .row .col.pressure .fuel .fuelp #fuelp-bar {
      width: 100%;
      height: 30%;
      bottom: 0;
      background-color: orange;
      position: absolute;
    }

    #ft .row .col.pressure .fuel .fuelp p {
      color: black;
      font-weight: bold;
      position: relative;
      font-size: 8pt;
    }

    #ft .row .col.pressure .fuel .fuelp hr {
      border: 1px solid black;
      width: 80%;
      margin-left: 10%;
      margin-top: 2px;
      position: relative;
    }

    #ft .row .col.pressure p {
      color: orange;
    }

    #ft #rpm-bar-numbers {
      width: 100%;
      text-align-last: justify;
      display: inline-block;
    }
  </style>
</head>

<body>
  <!-- <button onclick="openWin()">Open Window</button> -->
  <main id="ft">
    <div class="row">
      <div class="col rpm">
        <p id="rpm">7380</p>
      </div>
      <div class="col max-rpm">
        <p id="max-rpm">11000</p>
        <br />
        <p>RPM</p>
      </div>
      <div class="col"></div>
    </div>
    <div class="row bar">
      <ul id="rpm-bar">
      </ul>
    </div>
    <div id="rpm-bar-numbers">
      1 2 3 4 5 6 7 8 9</div>
    <div class="row">
      <div class="col"></div>
      <div class="col gear">
        <p>Gear</p>
        <p id="gear">3</p>
      </div>
      <div class="col kmh">
        <p>Front</p>
        <p id="kmh">115</p>
        <p>Kmh</p>
      </div>
    </div>
    <div class="row">
      <div class="col info">
        <div class="map">
          <p>MAP</p>
          <p>26.0</p>
        </div>
        <div class="bat">
          <p>Bat.</p>
          <p>16.1</p>
        </div>
      </div>
      <div class="col tps">
        <p>Turbo Boost</p>
        <div id="tps">
          <span>
            <p>0%</p>
          </span>
          <span></span>
          <span>
            <p>50%</p>
          </span>
          <span></span>
          <span>
            <p>100%</p>
          </span>
          <div id="tps-bar"></div>
        </div>
      </div>
      <div class="col pressure">
        <div class="oil">
          <p>Oil</p>
          <div id="oilp"></div>
        </div>
        <div class="fuel">
          <p>Fuel</p>
          <div class="fuelp">
            <div id="fuelp-bar">
            </div>
            <p>80%</p>
            <hr>
            <p>60%</p>
            <hr>
            <p>40%</p>
            <hr>
            <p>20%</p>
            <hr>
            <p>0%</p>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script>
    function renderRPM(percen) {
      if (percen > 100) return
      const rpmBar = document.getElementById('rpm-bar')
      rpmBar.innerHTML = ''
      let defH = 25
      for (let i = 0; i < 200; i++) {
        const rpmBarLi = document.createElement('li')
        if (i > 100 && i < 170) {
          defH += 0.5
          rpmBarLi.style.height = defH + 'px'
        } else if (i >= 170) {
          rpmBarLi.style.height = '60px'
        }
        if (i > (percen * 2)) {
          rpmBarLi.style.backgroundColor = '#242424'
        } else {
          rpmBarLi.style.background = 'linear-gradient(90deg, rgba(255,218,0,1) 0%, rgba(255,0,0,1) 30%)'
          rpmBarLi.style.backgroundAttachment = 'fixed'
        }
        rpmBar.appendChild(rpmBarLi)
      }
    }
    renderRPM(-1)

    function renderTurboBoost(percen) {
      const tbs = document.getElementById('tps-bar')
      tbs.style.width = percen + '%'
    }

    function renderFuel(percen) {
      const fbar = document.getElementById('fuelp-bar')


      fbar.style.height = percen + '%'
    }

    async function req() {
      await fetch('http://127.0.0.1:5000/ac')
        .then(T => T.json())
        .then((v) => {
          const gear = document.getElementById('gear')
          const rpm = document.getElementById('rpm')
          const kmh = document.getElementById('kmh')
          const max_rpm = document.getElementById('max-rpm')
          if (max_rpm.innerText !== v.static.maxRpm) {
            max_rpm.innerText = v.static.maxRpm
            const rpm_bar_numbers = document.getElementById('rpm-bar-numbers')
            let numbers = [...Array(Number(Math.round(v.static.maxRpm).toString()[0]) + 1).keys()]
            numbers.shift()
            rpm_bar_numbers.innerText = numbers.join(' ')
          }
          kmh.innerText = v.physics.speedKmh.toFixed(0)
          if (v.physics.gear - 1 === 0) {
            gear.innerText = 'N'
          }
          else if (v.physics.gear - 1 < 0) {
            gear.innerText = 'R'
          }
          else {
            gear.innerText = v.physics.gear - 1
          }
          // console.log(v)
          rpm.innerText = v.physics.rpms
          if (v.physics.rpms && v.static.maxRpm) {
            renderRPM((v.physics.rpms / v.static.maxRpm) * 100)
          }
          console.log((v.physics.fuel / v.static.maxFuel) * 100)
          if (v.physics.fuel && v.static.maxFuel) {
            renderFuel((v.physics.fuel / v.static.maxFuel) * 100)
          }
          if (v.physics.turboBoost && v.static.maxTurboBoost) {
            renderTurboBoost((v.physics.turboBoost.toFixed(2) / v.static.maxTurboBoost.toFixed(2)) * 100)
          }
          new Promise(r => setTimeout(r, 500));
        })
      req()
    }
    req()
    function openWin() {
      var myWindow = window.open("http://localhost:8000", "", "width=1200,height=600");
    }
  </script>
</body>

</html>
